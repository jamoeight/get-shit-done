# Research Summary: v1.2 Terminal Path Resolution

**Project:** GSD Lazy Mode - Terminal Path Fix
**Domain:** Cross-platform terminal spawning with path resolution
**Researched:** 2026-01-21
**Confidence:** HIGH

## Executive Summary

The v1.2 bug occurs because `wt.exe` spawns the user's Windows Terminal default profile, which may be any bash variant (Git Bash, WSL, Cygwin), each requiring different path formats. The current fix hardcodes Git Bash, which works for 90%+ of users but fails when Git Bash isn't installed or isn't at the standard location.

**Recommended approach:** Keep current explicit Git Bash approach, add existence check with fallback to cmd.exe. Optionally implement runtime path resolution for universal compatibility.

## Key Findings

### Root Cause

`wt.exe` spawns the user's configured default profile:
- **Git Bash:** expects `/c/Users/...`
- **WSL:** expects `/mnt/c/Users/...`
- **Cygwin:** expects `/cygdrive/c/Users/...`
- **PowerShell/cmd:** expects `C:\Users\...`

Previous fixes assumed a specific bash variant would run.

### Path Conversion Tools

| Environment | Tool | Example |
|-------------|------|---------|
| Git Bash/MSYS2 | `cygpath -u` | `C:\foo` → `/c/foo` |
| WSL | `wslpath -u` | `C:\foo` → `/mnt/c/foo` |
| Cygwin | `cygpath -u` | `C:\foo` → `/cygdrive/c/foo` |

These native tools are authoritative - they know their own path format.

### Detection Methods

**In bash (recommended):**
- `$OSTYPE`: `msys` (Git Bash), `cygwin`, `linux-gnu` (native/WSL)
- `uname -s`: `MINGW64_NT*`, `CYGWIN_NT*`, `Linux`
- `$WSL_DISTRO_NAME`: set only in WSL

**In Node.js (pre-spawn - less reliable):**
- Read Windows Terminal settings.json for default profile
- Check `process.env.MSYSTEM`, `WSL_DISTRO_NAME`

### Solution Options

| Option | Description | Reliability | Complexity |
|--------|-------------|-------------|------------|
| **A: Explicit Git Bash** | Hardcode Git Bash path (current) | HIGH for common case | LOW |
| **B: Existence check + fallback** | Add fs.existsSync, fall through to cmd.exe | HIGH | LOW |
| **C: Runtime resolution** | Let bash script resolve paths | HIGHEST | MEDIUM |
| **D: Force profile** | `wt.exe -p "Git Bash"` | MEDIUM (profile name varies) | LOW |
| **E: Avoid wt.exe** | Demote to cmd.exe | HIGH | LOW |

### Recommended Implementation

**For v1.2 (minimal fix):**
1. Keep current explicit Git Bash approach
2. Add `fs.existsSync()` check for Git Bash at standard path
3. Try common alternative paths (`C:\Git\bin\bash.exe`, scoop install)
4. If not found, return `null` and let `findTerminal()` fall through to cmd.exe

**For future (if edge cases arise):**
- Implement runtime path resolution using `cygpath`/`wslpath`
- Let ralph.sh detect its environment and convert paths at runtime

## Critical Pitfalls to Avoid

1. **Never assume which bash wt.exe will spawn** - depends on user config
2. **Always quote paths** - spaces and special characters break commands
3. **Can't detect bash type before launch** - pre-spawn detection uses different bash
4. **cygpath not available in WSL** - use wslpath instead
5. **January 2025 KB5050021 bug** - wt.exe may fail silently; have fallback

## Files Created

| File | Content |
|------|---------|
| `STACK-RESEARCH.md` | Tools, detection methods, npm packages evaluated |
| `FEATURES.md` | Path resolution patterns, how major tools solve this |
| `v1.2-TERMINAL-PATH-ARCHITECTURE.md` | 5 architecture options compared |
| `PITFALLS-terminal-path.md` | 13 pitfalls with prevention strategies |

## Requirements Implications

**Must have:**
- PATH-01: Git Bash existence check before wt.exe launch
- PATH-02: Fallback to cmd.exe when Git Bash not found
- PATH-03: Clear error messages when no suitable terminal found

**Should have:**
- PATH-04: Try multiple Git Bash installation locations
- PATH-05: Manual fallback instructions as last resort

**Could have (defer):**
- PATH-06: Runtime path resolution in ralph.sh
- PATH-07: Support for non-Git-Bash profiles (WSL, Cygwin)

## Confidence Assessment

| Area | Level | Reason |
|------|-------|--------|
| Path formats | HIGH | Official MSYS2, Cygwin, WSL documentation |
| Detection methods | HIGH | Bash built-ins, verified across sources |
| Recommended approach | MEDIUM | Architectural judgment, needs real-world testing |
| Pitfalls | HIGH | Validated through project failure history |

## Sources

**Official:**
- [Windows Terminal CLI](https://learn.microsoft.com/en-us/windows/terminal/command-line-arguments)
- [MSYS2 Filesystem Paths](https://www.msys2.org/docs/filesystem-paths/)
- [Cygwin cygpath](https://cygwin.com/cygwin-ug-net/cygpath.html)

**Project Experience:**
- Commits: `307cb70`, `8502138`, `82ae4c1`, `538155e`, `28739db`
- Bug documentation: `.planning/todos/v1.2-terminal-path-resolution.md`

---
*Research complete: 2026-01-21*
*Ready for requirements: YES*
