---
phase: 10-execution-commands
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/lib/budget.sh
  - commands/gsd/autopilot.md
autonomous: true

must_haves:
  truths:
    - "User can run /gsd:autopilot and see settings prompts"
    - "Config file stores circuit_breaker_threshold and stuck_threshold"
    - "Autopilot validates lazy mode before proceeding"
  artifacts:
    - path: "commands/gsd/autopilot.md"
      provides: "Autopilot skill command skeleton"
      min_lines: 100
    - path: "bin/lib/budget.sh"
      provides: "Extended config with safety thresholds"
      contains: "CIRCUIT_BREAKER_THRESHOLD"
  key_links:
    - from: "commands/gsd/autopilot.md"
      to: "bin/lib/budget.sh"
      via: "sources config for defaults"
      pattern: "source.*ralph-config"
---

<objective>
Create autopilot command skeleton with config infrastructure extension.

Purpose: Establish the entry point command for autonomous execution with configurable safety thresholds.
Output: Working autopilot.md with settings prompts, extended budget.sh with new config fields.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-execution-commands/10-CONTEXT.md
@.planning/phases/10-execution-commands/10-RESEARCH.md
@bin/lib/budget.sh
@bin/lib/mode.sh
@commands/gsd/lazy-mode.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend budget.sh with safety threshold config</name>
  <files>bin/lib/budget.sh</files>
  <action>
Add new config fields to budget.sh:
- CIRCUIT_BREAKER_THRESHOLD (default: 5)
- STUCK_THRESHOLD (default: 3)

Modify load_config() to:
- Load CIRCUIT_BREAKER_THRESHOLD from config (default 5)
- Load STUCK_THRESHOLD from config (default 3)
- Export both variables

Modify save_config() to:
- Include CIRCUIT_BREAKER_THRESHOLD in output
- Include STUCK_THRESHOLD in output
- Preserve existing GSD_MODE handling

Create prompt_all_settings() function that:
- Loads existing config as defaults
- Prompts for all four settings: MAX_ITERATIONS, TIMEOUT_HOURS, CIRCUIT_BREAKER_THRESHOLD, STUCK_THRESHOLD
- Uses editable defaults pattern (read -e -i)
- Validates each as positive integer
- Saves all to config
  </action>
  <verify>
- grep "CIRCUIT_BREAKER_THRESHOLD" bin/lib/budget.sh shows variable loading
- grep "STUCK_THRESHOLD" bin/lib/budget.sh shows variable loading
- grep "prompt_all_settings" bin/lib/budget.sh shows new function
  </verify>
  <done>budget.sh exports four config values and provides unified prompt function</done>
</task>

<task type="auto">
  <name>Task 2: Create autopilot.md command skeleton</name>
  <files>commands/gsd/autopilot.md</files>
  <action>
Create commands/gsd/autopilot.md following the skill command pattern from lazy-mode.md.

Frontmatter:
- name: gsd:autopilot
- description: Plan and execute milestone autonomously
- argument-hint: none
- allowed-tools: Read, Write, Bash, Glob, Grep, Task

Objective section:
- Single unified command for lazy mode execution
- "Confirm settings, press go, walk away" UX (self-driving car metaphor)

Context section:
- References bin/lib/budget.sh, mode.sh, parse.sh
- References ralph.sh, plan-milestone-all.md

Process section with steps:

Step 0: Validate Mode
- Source .planning/.ralph-config
- If GSD_MODE == "interactive", show error with alternative (use execute-phase)
- If GSD_MODE unset, allow (same pattern as plan-milestone-all)

Step 1: Prompt for Settings (ALWAYS - no --yes flag)
- Use prompt_all_settings from budget.sh pattern
- Show current values as editable defaults
- Prompt: MAX_ITERATIONS, TIMEOUT_HOURS, CIRCUIT_BREAKER_THRESHOLD, STUCK_THRESHOLD
- Save to .ralph-config after confirmation

Step 2-5: Placeholder comments for next plan
- Step 2: Detect existing plans
- Step 3: Detect incomplete runs
- Step 4: Execute (plan if needed, then ralph.sh)
- Step 5: Handle completion/interruption

Success criteria:
- [ ] Mode validated (lazy or unset)
- [ ] Settings prompted and saved
- [ ] Ready for Plan 02 to add execution logic
  </action>
  <verify>
- Test file exists: ls commands/gsd/autopilot.md
- grep "gsd:autopilot" commands/gsd/autopilot.md shows correct name
- grep "Validate Mode" commands/gsd/autopilot.md shows step 0
- grep "prompt_all_settings" commands/gsd/autopilot.md shows settings reference
  </verify>
  <done>autopilot.md exists with mode validation and settings prompts, placeholder for execution logic</done>
</task>

</tasks>

<verification>
After both tasks:
- bin/lib/budget.sh has prompt_all_settings function with 4 config values
- commands/gsd/autopilot.md exists with proper structure
- Command skeleton validates mode and prompts for settings
</verification>

<success_criteria>
- budget.sh extended with CIRCUIT_BREAKER_THRESHOLD and STUCK_THRESHOLD
- prompt_all_settings function prompts for all 4 settings
- autopilot.md command skeleton with mode validation and settings prompt steps
- Ready for Plan 02 to add plan detection, resume detection, and execution
</success_criteria>

<output>
After completion, create `.planning/phases/10-execution-commands/10-01-SUMMARY.md`
</output>
