---
phase: 11-terminal-launcher
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - commands/gsd/autopilot.md
autonomous: false

must_haves:
  truths:
    - "User runs autopilot and ralph.sh launches in a new terminal window"
    - "Ralph.sh continues running after autopilot command returns"
    - "User can close Claude session without stopping ralph.sh"
    - "If terminal launch fails, manual instructions are shown"
  artifacts:
    - path: "commands/gsd/autopilot.md"
      provides: "Terminal launcher integration"
      contains: "terminal-launcher"
  key_links:
    - from: "commands/gsd/autopilot.md"
      to: "bin/lib/terminal-launcher.js"
      via: "require or Bash call"
      pattern: "terminal-launcher"
---

<objective>
Integrate terminal-launcher.js into the autopilot command so that ralph.sh launches in a separate terminal window instead of running inline.

Purpose: Complete the execution isolation feature (EXEC-01). After this plan, running `/gsd:autopilot` will open a new terminal with ralph.sh running, allowing users to close their Claude session.

Output: Updated autopilot.md that uses terminal-launcher.js
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-terminal-launcher/11-01-SUMMARY.md

# Current autopilot command
@commands/gsd/autopilot.md

# Terminal launcher module (from Plan 01)
@bin/lib/terminal-launcher.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Modify autopilot.md Step 4 to use terminal-launcher</name>
  <files>commands/gsd/autopilot.md</files>
  <action>
1. Read the current autopilot.md file and locate Step 4 (execute step).

2. The current Step 4 runs ralph.sh inline:
```bash
./bin/ralph.sh 2>&1
```

3. Replace Step 4 with terminal launching approach. Update the step to:

```xml
<step name="execute">
**Step 4: Launch in New Terminal**

Display launch confirmation with settings summary:

```
==========================================
 GSD AUTOPILOT - READY TO LAUNCH
==========================================

Mode: Lazy (autonomous)
Plans: {count} across {phases} phases
Settings:
  - Max iterations: {MAX_ITERATIONS}
  - Timeout: {TIMEOUT_HOURS}h
  - Circuit breaker: {CIRCUIT_BREAKER_THRESHOLD} failures
  - Stuck threshold: {STUCK_THRESHOLD} retries

Launching ralph.sh in new terminal window...
==========================================
```

**Launch ralph.sh in a new terminal window:**

Use the terminal-launcher module to spawn ralph.sh in a detached terminal:

```bash
node bin/lib/terminal-launcher.js
```

Alternatively via Node.js in Bash tool:
```bash
node -e "const launcher = require('./bin/lib/terminal-launcher.js'); const result = launcher.launchTerminal(); process.exit(result.success ? 0 : 1);"
```

**Capture the result:**
- If exit code 0: Terminal launched successfully, proceed to Step 5 success
- If exit code 1: Terminal launch failed, manual instructions already displayed

**Important:** Do NOT wait for ralph.sh to complete. The terminal-launcher spawns a detached process and returns immediately. This is the execution isolation feature.
</step>
```

4. Update Step 5 (completion) to reflect new behavior:

```xml
<step name="completion">
**Step 5: Handle Launch Result**

Parse the result from terminal-launcher and display appropriate message.

**Success (exit 0 from launcher):**
```
==========================================
 GSD AUTOPILOT - LAUNCHED
==========================================

Ralph.sh is now running in a new terminal window.

You can now close this Claude session - execution continues independently.

To monitor progress:
  - Watch the new terminal window
  - Check .planning/STATE.md for status
  - Run /gsd:progress after completion

When ralph.sh completes:
  - Review work in .planning/phases/
  - Run /gsd:complete-milestone when ready
==========================================
```

**Failure (exit 1 from launcher):**
```
==========================================
 GSD AUTOPILOT - MANUAL LAUNCH REQUIRED
==========================================

Could not auto-launch terminal window.
Manual instructions were displayed above.

After starting ralph.sh manually:
  - Watch the terminal for progress
  - Check .planning/STATE.md for status
  - Run /gsd:progress after completion
==========================================
```

**Note:** Unlike the previous inline execution, we no longer handle STUCK/ABORTED/INTERRUPTED exit codes here. Those conditions are now handled by ralph.sh in its own terminal window. The autopilot command simply launches and exits.
</step>
```

5. Update the success_criteria at the bottom of autopilot.md:

```xml
<success_criteria>
- [ ] Mode validated (lazy or unset, error on interactive)
- [ ] All 4 settings prompted and saved to .ralph-config
- [ ] Plan detection checks all phases have plans
- [ ] Planning triggered via plan-milestone-all when plans missing
- [ ] Resume detection checks STATE.md for incomplete runs
- [ ] Terminal launcher spawns ralph.sh in new window
- [ ] Autopilot returns immediately after launch (does not wait)
- [ ] Manual instructions shown if terminal launch fails
</success_criteria>
```

6. Remove the exit code handling section that referenced ralph.sh exit codes (0-3) since we no longer wait for ralph.sh to complete.
  </action>
  <verify>
- autopilot.md references terminal-launcher: `grep -l "terminal-launcher" commands/gsd/autopilot.md`
- Old inline execution removed: `! grep -q "\\./bin/ralph.sh 2>&1" commands/gsd/autopilot.md`
- Success criteria updated: `grep -q "Terminal launcher spawns" commands/gsd/autopilot.md`
  </verify>
  <done>autopilot.md Step 4 uses terminal-launcher.js to spawn ralph.sh in a new terminal window</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify end-to-end terminal launch</name>
  <what-built>
Terminal launcher integration into autopilot command. When user runs /gsd:autopilot:
1. Settings are prompted (existing behavior)
2. Plans are checked/generated (existing behavior)
3. Ralph.sh launches in a NEW terminal window (new behavior)
4. Autopilot returns immediately (user can close Claude session)
  </what-built>
  <how-to-verify>
**Test 1: Terminal detection**
Run in terminal:
```bash
node -e "const t = require('./bin/lib/terminal-launcher.js'); console.log('Platform:', process.platform); console.log('Terminal:', t.findTerminal(process.platform));"
```
Expected: Shows your platform and detected terminal (e.g., `cmd.exe` or `wt.exe` on Windows)

**Test 2: Manual terminal launch**
Run in terminal:
```bash
node bin/lib/terminal-launcher.js
```
Expected: A new terminal window opens (you can close it after verifying)

**Test 3: Full autopilot flow (optional - only if you have a project with plans)**
In Claude, run `/gsd:autopilot` and verify:
1. Settings prompt appears
2. After confirming, a new terminal window opens
3. Ralph.sh starts running in that window
4. Autopilot command returns to Claude prompt (doesn't wait)
5. You can close Claude and the terminal window keeps running
  </how-to-verify>
  <resume-signal>Type "approved" if terminal launches correctly, or describe any issues encountered</resume-signal>
</task>

</tasks>

<verification>
1. autopilot.md references terminal-launcher.js
2. Step 4 spawns detached terminal instead of inline execution
3. Step 5 handles launch success/failure (not ralph.sh completion)
4. User verification confirms terminal actually opens
</verification>

<success_criteria>
- [ ] autopilot.md updated to use terminal-launcher.js
- [ ] Inline `./bin/ralph.sh 2>&1` execution removed
- [ ] Launch success message indicates user can close Claude session
- [ ] Launch failure shows manual instructions
- [ ] Human verified: new terminal window opens when running autopilot
- [ ] Human verified: ralph.sh continues running after Claude prompt returns
</success_criteria>

<output>
After completion, create `.planning/phases/11-terminal-launcher/11-02-SUMMARY.md`
</output>
